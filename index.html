// FILE: index.html
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>ИТО — интерактивная диаграмма</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <div class="app" id="app">

    <!-- Mobile header -->
    <header class="mHeader" id="mHeader" aria-label="Навигация">
      <div class="mTop">
        <div class="brand" aria-label="Заголовок">
          <div class="brandTitle">Процесс ИТО</div>
          <div class="brandSub" id="mSub">Группа → шаг → детали</div>
        </div>
        <div class="mActions" aria-label="Действия">
          <button class="iconBtn" id="openDiagram" type="button" aria-label="Открыть диаграмму">⧉</button>
          <button class="iconBtn" id="openSheet" type="button" aria-label="Открыть детали">≡</button>
        </div>
      </div>

      <div class="chipRow" id="groupChips" aria-label="Группы P0–P7">
        <!-- chips injected by JS -->
      </div>
    </header>

    <!-- Desktop nav -->
    <aside class="nav" aria-label="Этапы процесса">
      <div class="navHeader">
        <div class="navTitle">Этапы процесса</div>
        <div class="navHint">Клик по этапу → подсветка на диаграмме</div>
      </div>
      <div class="navList">
          <button class="navItem" type="button" data-group="P0">P0 — Старт проекта</button>
          <button class="navItem" type="button" data-group="P1">P1 — Пресейл / КП</button>
          <button class="navItem" type="button" data-group="P2">P2 — Документация (ПРД)</button>
          <button class="navItem" type="button" data-group="P3">P3 — Спецификация / Закупки</button>
          <button class="navItem" type="button" data-group="P4">P4 — Площадка / Монтаж</button>
          <button class="navItem" type="button" data-group="P5">P5 — ПНР / Изменения</button>
          <button class="navItem" type="button" data-group="P6">P6 — Испытания / Приёмка</button>
          <button class="navItem" type="button" data-group="P7">P7 — Исполнительная / Закрытие</button>
      </div>
    </aside>

    <main class="center">
      <!-- Desktop toolbar -->
      <div class="toolbar" aria-label="Инструменты">
        <div class="zoomControls" aria-label="Масштаб (десктоп)">
          <button id="zoomOut" type="button" aria-label="Уменьшить">−</button>
          <input id="zoomRange" type="range" min="60" max="220" value="70" aria-label="Масштаб"/>
          <button id="zoomIn" type="button" aria-label="Увеличить">+</button>
          <button id="zoomFit" type="button">Fit</button>
          <div id="zoomLabel" aria-hidden="true">70%</div>
        </div>
        <div class="hint" aria-hidden="true">Клик по блоку → детали справа</div>
      </div>

      <!-- Mobile: Group summary + Step list -->
      <section class="mobileFlow" aria-label="Список шагов">
        <div class="groupHeader">
          <div class="groupTitle" id="groupTitle">—</div>
          <div class="groupMeta" id="groupMeta">—</div>
        </div>

        <div class="stepList" id="stepList" aria-label="Шаги выбранной группы">
          <!-- injected by JS -->
        </div>

        <div class="mobileHint" id="mobileHint">
          Тапни по карточке шага — детали откроются снизу.
        </div>
      </section>

      <!-- Desktop: Diagram viewport -->
      <div id="viewport" class="viewport" aria-label="Диаграмма процесса">
        <div id="svgWrap"></div>
      </div>
    </main>

    <!-- Right panel (desktop) / Bottom sheet (mobile) -->
    <aside class="right sheet" id="panelSheet" aria-label="Детали шага">
      <div class="sheetHeader" id="sheetHeader">
        <div class="sheetGrab" aria-hidden="true"></div>

        <button class="iconBtn" id="sheetBack" type="button" aria-label="Свернуть">←</button>

        <div class="sheetTitle" aria-label="Текущий шаг">
          <div class="sheetId" id="sheetStepId">Шаг</div>
          <div class="sheetName" id="sheetStepTitle">Выбери шаг</div>
          <div class="sheetStage" id="sheetStepStage"></div>
        </div>

        <button class="iconBtn" id="sheetClose" type="button" aria-label="Закрыть">✕</button>
      </div>

      <div class="sheetBody" id="sheetBody">
        <div id="panel">
          <div class="panelEmpty">
            <div class="panelEmptyTitle">Выбери шаг</div>
            <div class="panelEmptySub">Карточка шага (сверху) или блок на диаграмме</div>
          </div>
        </div>
      </div>
    </aside>

  </div>

  <div id="sheetOverlay" class="overlay" hidden></div>

  <!-- Mobile: full-screen diagram modal (optional context) -->
  <div id="diagramModal" class="diagramModal" hidden aria-label="Диаграмма (контекст)">
    <div class="diagramTop">
      <button class="iconBtn" id="diagramClose" type="button" aria-label="Назад">←</button>
      <div class="diagramTitle">Диаграмма</div>
      <div class="diagramSpacer" aria-hidden="true"></div>
    </div>

    <div id="diagramViewport" class="diagramViewport" aria-label="Просмотр диаграммы">
      <div id="diagramSvgWrap"></div>
    </div>

    <div class="diagramHint">Тап по блоку — откроются детали</div>
  </div>

  <!-- Desktop SVG (mounted only on >=768px) -->
  <template id="desktopSvgTemplate">
<svg xmlns="http://www.w3.org/2000/svg" width="2238" height="1446" viewBox="0 0 2238 1446">
  <defs>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#444"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="6" stdDeviation="6" flood-color="#000" flood-opacity="0.18"/>
    </filter>
    <style><![CDATA[
      .lane-title{font:700 20px ui-sans-serif,system-ui; fill:#2b2b2b;}
      .box{fill:#fff; stroke:#a8a8a8; stroke-width:1.2; rx:14; filter:url(#shadow);}
      .hit{fill:transparent;}
      .id{font:700 14px ui-sans-serif,system-ui; fill:#777;}
      .title{font:600 14px ui-sans-serif,system-ui; fill:#111;}
      .step{cursor:pointer;}
    ]]></style>
  </defs>

  <text x="100" y="60" class="lane-title">P0 — Старт проекта</text>
  <text x="460" y="60" class="lane-title">P1 — Пресейл / КП</text>
  <text x="820" y="60" class="lane-title">P2 — Документация (ПРД)</text>
  <text x="1180" y="60" class="lane-title">P3 — Спецификация / Закупки</text>
  <text x="1540" y="60" class="lane-title">P4 — Площадка / Монтаж</text>
  <text x="100" y="760" class="lane-title">P5 — ПНР / Изменения</text>
  <text x="820" y="760" class="lane-title">P6 — Испытания / Приёмка</text>
  <text x="1540" y="760" class="lane-title">P7 — Исполнительная / Закрытие</text>

  <line x1="220" y1="180" x2="220" y2="250" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="220" y1="320" x2="220" y2="390" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="220" y1="460" x2="220" y2="530" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="220" y1="600" x2="220" y2="670" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="580" y1="180" x2="580" y2="250" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="580" y1="320" x2="580" y2="390" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="580" y1="460" x2="580" y2="530" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="940" y1="180" x2="940" y2="250" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="940" y1="320" x2="940" y2="390" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="940" y1="460" x2="940" y2="530" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1300" y1="180" x2="1300" y2="250" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1300" y1="320" x2="1300" y2="390" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1300" y1="460" x2="1300" y2="530" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="180" x2="1660" y2="250" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="320" x2="1660" y2="390" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="460" x2="1660" y2="530" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="600" x2="1660" y2="670" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>

  <line x1="220" y1="680" x2="220" y2="800" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="220" y1="880" x2="220" y2="1000" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="220" y1="1080" x2="220" y2="1200" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="940" y1="880" x2="940" y2="1000" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="940" y1="1080" x2="940" y2="1200" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="880" x2="1660" y2="1000" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="1080" x2="1660" y2="1200" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="1660" y1="1280" x2="1660" y2="1400" stroke="#444" stroke-width="2" marker-end="url(#arrow)"/>

  <line x1="220" y1="720" x2="820" y2="720" stroke="#444" stroke-width="3" marker-end="url(#arrow)"/>
  <line x1="940" y1="720" x2="1540" y2="720" stroke="#444" stroke-width="3" marker-end="url(#arrow)"/>

  <g class="step" data-id="P0.01"><rect class="hit" x="92" y="92" width="256" height="96" rx="18"/><rect class="box" x="100" y="100" width="240" height="80" rx="14"/><text x="118" y="128" class="id">P0.01</text><text x="118" y="152" class="title">Запрос получен</text></g>
  <g class="step" data-id="P0.02"><rect class="hit" x="92" y="232" width="256" height="96" rx="18"/><rect class="box" x="100" y="240" width="240" height="80" rx="14"/><text x="118" y="268" class="id">P0.02</text><text x="118" y="292" class="title">Зафиксировать запрос</text></g>
  <g class="step" data-id="P0.03"><rect class="hit" x="92" y="372" width="256" height="96" rx="18"/><rect class="box" x="100" y="380" width="240" height="80" rx="14"/><text x="118" y="408" class="id">P0.03</text><text x="118" y="432" class="title">Подготовить вводные</text></g>
  <g class="step" data-id="P0.04"><rect class="hit" x="92" y="512" width="256" height="96" rx="18"/><rect class="box" x="100" y="520" width="240" height="80" rx="14"/><text x="118" y="548" class="id">P0.04</text><text x="118" y="572" class="title">Встреча с заказчиком</text></g>
  <g class="step" data-id="P0.05"><rect class="hit" x="92" y="652" width="256" height="96" rx="18"/><rect class="box" x="100" y="660" width="240" height="80" rx="14"/><text x="118" y="688" class="id">P0.05</text><text x="118" y="712" class="title">Первичное ТЗ</text></g>

  <g class="step" data-id="P1.01"><rect class="hit" x="452" y="92" width="256" height="96" rx="18"/><rect class="box" x="460" y="100" width="240" height="80" rx="14"/><text x="478" y="128" class="id">P1.01</text><text x="478" y="152" class="title">Пресейл старт</text></g>
  <g class="step" data-id="P1.02"><rect class="hit" x="452" y="232" width="256" height="96" rx="18"/><rect class="box" x="460" y="240" width="240" height="80" rx="14"/><text x="478" y="268" class="id">P1.02</text><text x="478" y="292" class="title">Оценка реализуемости</text></g>
  <g class="step" data-id="P1.03"><rect class="hit" x="452" y="372" width="256" height="96" rx="18"/><rect class="box" x="460" y="380" width="240" height="80" rx="14"/><text x="478" y="408" class="id">P1.03</text><text x="478" y="432" class="title">Состав КП</text></g>
  <g class="step" data-id="P1.04"><rect class="hit" x="452" y="512" width="256" height="96" rx="18"/><rect class="box" x="460" y="520" width="240" height="80" rx="14"/><text x="478" y="548" class="id">P1.04</text><text x="478" y="572" class="title">Согласование КП</text></g>

  <g class="step" data-id="P2.01"><rect class="hit" x="812" y="92" width="256" height="96" rx="18"/><rect class="box" x="820" y="100" width="240" height="80" rx="14"/><text x="838" y="128" class="id">P2.01</text><text x="838" y="152" class="title">Старт ПРД</text></g>
  <g class="step" data-id="P2.02"><rect class="hit" x="812" y="232" width="256" height="96" rx="18"/><rect class="box" x="820" y="240" width="240" height="80" rx="14"/><text x="838" y="268" class="id">P2.02</text><text x="838" y="292" class="title">Сбор исходных данных</text></g>
  <g class="step" data-id="P2.03"><rect class="hit" x="812" y="372" width="256" height="96" rx="18"/><rect class="box" x="820" y="380" width="240" height="80" rx="14"/><text x="838" y="408" class="id">P2.03</text><text x="838" y="432" class="title">Разработка ПРД</text></g>
  <g class="step" data-id="P2.04"><rect class="hit" x="812" y="512" width="256" height="96" rx="18"/><rect class="box" x="820" y="520" width="240" height="80" rx="14"/><text x="838" y="548" class="id">P2.04</text><text x="838" y="572" class="title">Согласование ПРД</text></g>

  <g class="step" data-id="P3.01"><rect class="hit" x="1172" y="92" width="256" height="96" rx="18"/><rect class="box" x="1180" y="100" width="240" height="80" rx="14"/><text x="1198" y="128" class="id">P3.01</text><text x="1198" y="152" class="title">Подготовить спецификацию</text></g>
  <g class="step" data-id="P3.02"><rect class="hit" x="1172" y="232" width="256" height="96" rx="18"/><rect class="box" x="1180" y="240" width="240" height="80" rx="14"/><text x="1198" y="268" class="id">P3.02</text><text x="1198" y="292" class="title">Запрос цен</text></g>
  <g class="step" data-id="P3.03"><rect class="hit" x="1172" y="372" width="256" height="96" rx="18"/><rect class="box" x="1180" y="380" width="240" height="80" rx="14"/><text x="1198" y="408" class="id">P3.03</text><text x="1198" y="432" class="title">Заключение договоров</text></g>
  <g class="step" data-id="P3.04"><rect class="hit" x="1172" y="512" width="256" height="96" rx="18"/><rect class="box" x="1180" y="520" width="240" height="80" rx="14"/><text x="1198" y="548" class="id">P3.04</text><text x="1198" y="572" class="title">Поставка</text></g>

  <g class="step" data-id="P4.01"><rect class="hit" x="1532" y="92" width="256" height="96" rx="18"/><rect class="box" x="1540" y="100" width="240" height="80" rx="14"/><text x="1558" y="128" class="id">P4.01</text><text x="1558" y="152" class="title">Подготовка площадки</text></g>
  <g class="step" data-id="P4.02"><rect class="hit" x="1532" y="232" width="256" height="96" rx="18"/><rect class="box" x="1540" y="240" width="240" height="80" rx="14"/><text x="1558" y="268" class="id">P4.02</text><text x="1558" y="292" class="title">Монтаж</text></g>
  <g class="step" data-id="P4.03"><rect class="hit" x="1532" y="372" width="256" height="96" rx="18"/><rect class="box" x="1540" y="380" width="240" height="80" rx="14"/><text x="1558" y="408" class="id">P4.03</text><text x="1558" y="432" class="title">Подключения</text></g>
  <g class="step" data-id="P4.04"><rect class="hit" x="1532" y="512" width="256" height="96" rx="18"/><rect class="box" x="1540" y="520" width="240" height="80" rx="14"/><text x="1558" y="548" class="id">P4.04</text><text x="1558" y="572" class="title">Проверка монтажа</text></g>
  <g class="step" data-id="P4.05"><rect class="hit" x="1532" y="652" width="256" height="96" rx="18"/><rect class="box" x="1540" y="660" width="240" height="80" rx="14"/><text x="1558" y="688" class="id">P4.05</text><text x="1558" y="712" class="title">Готовность к ПНР</text></g>

  <g class="step" data-id="P5.01"><rect class="hit" x="92" y="792" width="256" height="96" rx="18"/><rect class="box" x="100" y="800" width="240" height="80" rx="14"/><text x="118" y="828" class="id">P5.01</text><text x="118" y="852" class="title">Старт ПНР</text></g>
  <g class="step" data-id="P5.02"><rect class="hit" x="92" y="992" width="256" height="96" rx="18"/><rect class="box" x="100" y="1000" width="240" height="80" rx="14"/><text x="118" y="1028" class="id">P5.02</text><text x="118" y="1052" class="title">Изменения</text></g>
  <g class="step" data-id="P5.03"><rect class="hit" x="92" y="1192" width="256" height="96" rx="18"/><rect class="box" x="100" y="1200" width="240" height="80" rx="14"/><text x="118" y="1228" class="id">P5.03</text><text x="118" y="1252" class="title">Завершение ПНР</text></g>

  <g class="step" data-id="P6.01"><rect class="hit" x="812" y="992" width="256" height="96" rx="18"/><rect class="box" x="820" y="1000" width="240" height="80" rx="14"/><text x="838" y="1028" class="id">P6.01</text><text x="838" y="1052" class="title">Испытания</text></g>
  <g class="step" data-id="P6.02"><rect class="hit" x="812" y="1192" width="256" height="96" rx="18"/><rect class="box" x="820" y="1200" width="240" height="80" rx="14"/><text x="838" y="1228" class="id">P6.02</text><text x="838" y="1252" class="title">Приёмка</text></g>

  <g class="step" data-id="P7.01"><rect class="hit" x="1532" y="792" width="256" height="96" rx="18"/><rect class="box" x="1540" y="800" width="240" height="80" rx="14"/><text x="1558" y="828" class="id">P7.01</text><text x="1558" y="852" class="title">Исполнительная</text></g>
  <g class="step" data-id="P7.02"><rect class="hit" x="1532" y="992" width="256" height="96" rx="18"/><rect class="box" x="1540" y="1000" width="240" height="80" rx="14"/><text x="1558" y="1028" class="id">P7.02</text><text x="1558" y="1052" class="title">Сдача документов</text></g>
  <g class="step" data-id="P7.03"><rect class="hit" x="1532" y="1192" width="256" height="96" rx="18"/><rect class="box" x="1540" y="1200" width="240" height="80" rx="14"/><text x="1558" y="1228" class="id">P7.03</text><text x="1558" y="1252" class="title">Акты/закрытие</text></g>
  <g class="step" data-id="P7.04"><rect class="hit" x="1532" y="1392" width="256" height="96" rx="18"/><rect class="box" x="1540" y="1400" width="240" height="80" rx="14"/><text x="1558" y="1428" class="id">P7.04</text><text x="1558" y="1452" class="title">Передача проекта</text></g>

  <g class="step" data-id="P6.03"><rect class="hit" x="812" y="1392" width="256" height="96" rx="18"/><rect class="box" x="820" y="1400" width="240" height="80" rx="14"/><text x="838" y="1428" class="id">P6.03</text><text x="838" y="1452" class="title">Закрытие</text></g>

  <g class="step" data-id="P7.05"><rect class="hit" x="1292" y="1302" width="256" height="96" rx="18"/><rect class="box" x="1300" y="1310" width="240" height="80" rx="14"/><text x="1318" y="1338" class="id">P7.05</text><text x="1318" y="1362" class="title">Финализация</text></g>
  <g class="step" data-id="P7.06"><rect class="hit" x="1292" y="1402" width="256" height="96" rx="18"/><rect class="box" x="1300" y="1410" width="240" height="80" rx="14"/><text x="1318" y="1438" class="id">P7.06</text><text x="1318" y="1462" class="title">Передача и закрытие</text><text x="1318" y="1480" class="title">проекта</text></g>
</svg>
  </template>

  <script src="app.js"></script>
</body>
</html>
